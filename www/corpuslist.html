<!DOCTYPE html
	PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
	 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head>
<title>Cuneiform literacy</title>

        <!-- CSS -->
        <link rel="stylesheet" href="css/custom-theme/jquery-ui-1.8.14.custom.css" type="text/css" media="screen, print" />
        <link rel="stylesheet" href="css/jquery.gritter.css" type="text/css" media="screen" />
        <link rel="stylesheet" href="css/cuneiform.css" type="text/css" media="screen" />
        <!-- Libs JS-->
        <script src="lib/common-libs.js" type="text/javascript"></script>
        <script src="lib/jstorage.min.js" type="text/javascript"></script>
        <!-- Common Lib JS-->
        <script src="js/cuneiform_common.js" type="text/javascript"></script>
        
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
  
</head>
<body>
  corpus list

         
        <div >
            
            <div id="show_view" class="show_view accord"">
                <!-- Filled by JS -->
            </div>
            
        </div>


<script>
var cuneiform = cuneiform || {};

cuneiform.corpuslist = {};
//cuneiform.c.$viewgroup_container = $("#show_view");
cuneiform.c.$select_corpuslist = $("#show_view");

cuneiform.corpuslist.init = function() {

    cuneiform.common.get_user(function(user) {
        cuneiform.data.user = user;
        if(!user.loggedin){
            window.location = "./login.html";
            //alert(user.perms.fullname+":"+user.perms.crsid+":"+user.loggedin);
        }
        
        cuneiform.corpuslist.page_init();
    });
};

cuneiform.corpuslist.page_init = function() {

    // Fetch top feed
    $.ajax({
        type: "GET",
        url: cuneiform.config.urlTop,
        dataType: "json",
        success: function(data, textStatus, jqXHR) {

            if (data !== null) {
                // Save data in memory
                cuneiform.data.top = data;
                // Transform top data into a form which is easier to drive selectors from
//                cuneiform.data.selector = cuneiform.processTopData(cuneiform.data.top);
                // Read URL hash
//                var hash = $.deparam.fragment();

                // Read state stored in local storage
                //var storedState = ($.jStorage.get("mercury-list-selection") || false);
                
                //not used
//                cuneiform.corpuslist.pushState();

                // Wire up - not used
//                cuneiform.corpuslist.wire();
                
                // Render selector area - not used
		cuneiform.corpuslist.renderSelectors();
                
                //Render collegesedit
//                clashics.corpuslist.AllInit();
                //Bind buttons
                //clashics.corpuslist.buttons_bind();
                
            } else {
                alert("The following data feed did not produce any data: "+clashics.config.urlTop);
                cuneiform.data.top = {};
            }

        },
        error: function(jqXHR, textStatus, errorThrown) {
            var error_msg = "Could not load data from the feed!";
            ajaxError.apply(this, [null, jqXHR, $.ajaxSettings, errorThrown, error_msg]);
            cuneiform.data.top = {};
        }
    });

    cuneiform.common.login_link();
        
};

// (re)Renders the selectors in the section, based on mercury.data.top
cuneiform.corpuslist.renderSelectors = function() {
    
    //first render all the corpora
    
    var test = cuneiform.data.top;
    // Render year
    var chtml = '';
    _.each(cuneiform.data.top.ALLCorpora.corpus, function(cdata, corp){
        //var selected = (cuneiform.data.selectedYear === year) ? 'selected="true"' : "";
        //chtml += '<li value="'+year+'" '+selected+'>'+year+'</li>';
        
        chtml += '<h3 class="accorded">'+cdata["@attributes"]["name"]+'</h3><div class="accord">';
        
        _.each(cdata, function(subdata, sub){
            if(jQuery.type(subdata) === "object"){
                if(sub != "@attributes"){
                    var val = "unspecified";
                    if(subdata["@attributes"]){
                        val = subdata["@attributes"]["name"];
                    }
                    chtml += '<h4 class="accorded">'+sub+'</h4><div>'+val+'</div>';
                }
            }
            else{
           // alert(jQuery.type(subdata));
                if(jQuery.type(subdata) === "array"){
                    _.each(subdata, function(subarr, sub){
                        
                            var val = "unspecified";
                            if(subarr["@attributes"]){
                                val = subarr["@attributes"]["name"];
                            }
                            chtml += '<h4 class="accorded">'+sub+'</h4><div>'+val+'</div>';
                    });
                }
            }
        });
        
        chtml += '</div>';
        
    });
    cuneiform.c.$select_corpuslist.html(chtml);
    
  //  jQuery( ".accord" ).accordion();
    
}

cuneiform.corpuslist.showlist = function(){
    
    
}

</script>
<script>
        // Start with calling  page init function
$(document).ready(function() {
        try {
            cuneiform.corpuslist.init();
        } catch(err) {
            var error = 'Javascript error on page caught by list init try/catch  :' + err;
            cuneiform.common.report_error('error',error);
            alert("An error occurred loading this page. Perhaps you are using an unsupported browser? I suggest the basic javascript-free version, linked below.");
        }
});
</script>
</body>
</html>